{% extends 'base.html' %}
{% block title %}Ticket{% endblock %}
{% block content %}
<h2>Ticket</h2>
<form method="get" action="{{ url_for('tickets') }}" class="filters">
    <label for="status">Stato:</label>
    <select name="status" id="status" onchange="this.form.submit()">
        <option value="" {% if not selected_status %}selected{% endif %}>Tutti</option>
        {% for value, label in statuses %}
        <option value="{{ value }}" {% if value == selected_status %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
    </select>
    <noscript><button type="submit">Filtra</button></noscript>
</form>
<p><a class="button" href="{{ url_for('add_ticket', **current_filters) }}">Nuovo ticket</a></p>
{% if tickets %}
<table>
    <thead>
    <tr>
        <th>ID</th>
        <th>Cliente / Stato</th>
        <th>Oggetto</th>
        <th>Creato il</th>
    </tr>
    </thead>
    <tbody>
    {% for ticket in tickets %}
    <tr>
        <td><a href="{{ url_for('ticket_detail', ticket_id=ticket['id']) }}">{{ '%04d'|format(ticket['id']) }}</a></td>
        <td>
            <div class="ticket-customer">{{ ticket['customer_name'] }}</div>
            {% set status_slug = ticket['status']|replace('_', '-') %}
            <div class="ticket-status">
                <span class="badge badge-{{ status_slug }}">{{ ticket_status_labels.get(ticket['status'], ticket['status']) }}</span>
            </div>
        </td>
        <td>{{ ticket['subject'] }}</td>
        <td>{{ ticket['created_at'] }}</td>
    </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
<p>Nessun ticket presente.</p>
{% endif %}
{% endblock %}
