{% extends 'base.html' %}
{% block title %}Nuova riparazione{% endblock %}
{% block content %}
<h2>Registra riparazione</h2>
<form method="post">
    <label for="ticket_id">Ticket *</label>
    <select id="ticket_id" name="ticket_id" required>
        <option value="">-- seleziona --</option>
        {% for ticket in tickets %}
        {% set selected = request.args.get('ticket_id') == ticket['id']|string %}
        <option value="{{ ticket['id'] }}" {% if selected %}selected{% endif %}>{{ '%04d'|format(ticket['id']) }} - {{ ticket['subject'] }}</option>
        {% endfor %}
    </select>

    <label for="product">Prodotto *</label>
    <input type="text" id="product" name="product" required minlength="2">

    <div class="ai-helper">
        <label for="issue_description">Descrizione problema *</label>
        <textarea id="issue_description" name="issue_description" rows="4" required minlength="5"></textarea>
        <button type="button" class="ai-suggest-button" data-target="issue_description">
            Chiedi allâ€™AI
        </button>
        <div class="ai-suggestion" aria-live="polite"></div>
    </div>

    <label for="repair_status">Stato riparazione</label>
    <select id="repair_status" name="repair_status">
        <option value="pending">In attesa</option>
        <option value="in_progress">In lavorazione</option>
        <option value="completed">Completata</option>
    </select>

    <label for="date_received">Data ricezione</label>
    <input type="date" id="date_received" name="date_received">

    <label for="date_repaired">Data riparazione</label>
    <input type="date" id="date_repaired" name="date_repaired">

    <label for="date_returned">Data consegna</label>
    <input type="date" id="date_returned" name="date_returned">

    <button type="submit">Salva</button>
</form>
{% endblock %}
