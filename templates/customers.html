{% extends 'base.html' %}
{% block title %}Clienti{% endblock %}
{% block content %}
<h2>Clienti</h2>
<p><a class="button" href="{{ url_for('add_customer') }}">Nuovo cliente</a></p>
{% if customers %}
<table>
    <thead>
    <tr>
        <th>Nome</th>
        <th>Email</th>
        <th>Telefono</th>
        <th>Indirizzo</th>
        {% if current_user.is_authenticated and current_user.is_admin %}
        <th class="actions-column">Azioni</th>
        {% endif %}
    </tr>
    </thead>
    <tbody>
    {% for customer in customers %}
    <tr>
        <td>{{ customer['name'] }}</td>
        <td>{{ customer['email'] or '-' }}</td>
        <td>{{ customer['phone'] or '-' }}</td>
        <td>{{ customer['address'] or '-' }}</td>
        {% if current_user.is_authenticated and current_user.is_admin %}
        <td class="actions-column">
            <a class="button" href="{{ url_for('edit_customer', customer_id=customer['id']) }}" style="margin-right: 0.5rem;">Modifica</a>
            <form method="post"
                  action="{{ url_for('delete_customer', customer_id=customer['id']) }}"
                  class="inline-form"
                  onsubmit="return confirm('Confermi l\'eliminazione del cliente? Tutti i ticket associati verranno rimossi.');">
                {% if csrf_token is defined %}
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                {% endif %}
                <button type="submit" class="btn-danger">Elimina</button>
            </form>
        </td>
        {% endif %}
    </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
<p>Nessun cliente registrato.</p>
{% endif %}
{% endblock %}
